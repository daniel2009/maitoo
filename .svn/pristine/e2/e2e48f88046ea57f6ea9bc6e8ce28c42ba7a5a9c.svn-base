<%@ page language="java"  import="java.util.*" pageEncoding="UTF-8"%><html>	<head>	<link rel="shortcut icon" href="../img/favicon.ico" /> 	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />	</head>	<body>					<input type="hidden" name="porder" value=""/>	<input type="hidden" name="content" value=""/>	<input type="hidden" name="state" value=""/>	<input type="hidden" name="sdate" value=""/>	<input type="hidden" name="edate" value=""/>	<input type="hidden" name="pn" value="1"/>			<div class="block">		<p class="block-heading" data-toggle="collapse"			data-target="#chart-container" style="font-size:20px">运单列表</p>		<div class="box_content">			<div class="content_title">				海关清单列表							</div>			<div class="content_text">					<div class="tab-content default-tab" id="tab1">					<div id="u52" style="padding-top: 5px;">						<div id="u520">												<form id="import_form_porder"  action="${pageContext.request.contextPath }/admin/order/import_from_weiyi" onsubmit="return false"  method="post" enctype="multipart/form-data">			            <fieldset>			            <input type="hidden" name="seaprintid" value="${param.id }" />			            <p>			            	&nbsp;&nbsp;			            				            				              &nbsp;&nbsp;&nbsp;&nbsp; 海关运单上传：				              <input type="file" name="file" class="text-input" style="height: 20px;padding:6px;"/>				              <input class="button" type="submit" value="批量导入海关运单" id="import_porder_form"/>				              <a href="${pageContext.request.contextPath }/admin/seaprint/download_porder_example">模板下载</a>				             				            </p>				         </fieldset>				         <div class="clear"></div>			         </form>			         <hr/>			         			         <div>							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;扫描打印：<input type="text" name="scan_order_no" class="text-input" size="20" style="width:150px;" onkeypress="printkeydown(event)"/>							<input class="button" type="button" value="打印" name="print_button" style="height:20px" />&nbsp;&nbsp;<span>如果符合多条，直接打印第一条并且没有打印的</span>													</div>										         <hr/>																			<form action="" >							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;单号查询：<input type="text" name="search_order_no" class="text-input" size="20" style="width:150px;"/>							<input class="button" type="button" value="搜索" name="searchSub" style="height:20px"/>																				</form>							<br/>							<!-- <form action=""> -->							<form id="search_porder_list_and_download" action="${pageContext.request.contextPath }/admin/seaprint/down_porderlist"  method="post" enctype="multipart/form-data">							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;搜索内容：<input type="text" name="search_contect" class="text-input" size="20" style="width:150px;"/>								&nbsp;&nbsp;&nbsp;&nbsp;<select class="text-input" name="printflag" style="width:120px;">									<option value="-1">										请选择打印状态									</option>																	<option value="1">已打印</option>									<option value="0">未打印</option>								</select>																															<input type="hidden" name="seaprintid1" value="${param.id }" />								<input class="button" type="button" value="高级搜索" name="searchSub" />								&nbsp;&nbsp;&nbsp;&nbsp;								<input class="button" type="submit" value="下载海关清单" name="downtranporderlist" id="downporderlist_search"/>							</form>						</div>											<div id="u52">									         			         			         			         				         	 			       			         		<!-- <form id="import_form_meitao" action="" onsubmit="return false;" method="post" enctype="multipart/form-data">				              	&nbsp; 运单状态EXCEL文件：				              	<input type="file" name="file" class="text-input" style="height: 20px;"/>				              	<input class="button" type="submit" value="导入运单状态" id="import_order_from_meitao" />				         	<div class="clear"></div>			         		</form> -->						</div>						<div style="clear: both;"></div>					</div>					<br/>					<br/>					<br/>					<br/>					<br/>										<br/>					<br/>						<br/>					<br/>					<table style="width: 100%">						<col width="40px" />						<col width="100px" />						<!-- <col width="80px" /> -->						<col width="100px"/>						<col />						<col width="150px" />						<col width="80px" />						<col width="150px" />						<col width="100px" />						<col width="180px" />						<col width="180px" />						<col width="100px" />						<col width="100px" />						<thead>							<tr>								<th>									&nbsp;								</th>								<th id="o_id">									运单号								</th>								<th id="o_usa_no">									海关单号								</th>								<!-- <th id="o_usa_no">									国内快递号								</th> -->								<th id="o_user_name">									报关品名								</th>								<th id="o_consignee_name">									发货公司								</th>								<th id="o_state">									收货公司								</th>								<th id="o_storage_position_position">									收货地址								</th>								<th >									收货电话								</th>								<th >									身份证号								</th>								<th id="o_create_date">									创建时间								</th>								<th id="o_create_date">									打印状态								</th>								<th>									操作								</th>							</tr>						</thead>						<tfoot>							<tr>								<td colspan="7">																		<div class="pagination" style="font-size: 15px;">										共0条/共0页&nbsp;&nbsp;										<a href="">首页</a>|										<a href="#">上一页</a>										<input style="width: 20px;" type="text" name="pageNow" />										<a href="#">下一页</a>|										<a href="#">尾页</a>									</div>									<!-- End .pagination -->									<div class="clear"></div>								</td>							</tr>						</tfoot>						<tbody>						</tbody>					</table>				</div>			</div>		</div>		</div>		<!-- 不要删除这个div -->		<div id="tmpmsgdiv2" style="display:none;">		</div>			</body>	<script type="text/javascript">	$("#main-content").ready(function() {			loadporderlist("","","","1","");						$(":button[name='searchSub']").click(function() {								var porder = $(":text[name='search_order_no']").val();					var content = $(":text[name='search_contect']").val();					var state = $("select[name='printflag']").val();															$(":text[name='search_order_no']").val("");																									loadporderlist(porder,content,state,"1","");										return false;		});								$(":button[name='print_button']").click(function() {								var porder = $(":text[name='scan_order_no']").val();																				$(":text[name='scan_order_no']").val("");																									loadporderlist(porder,"","","1","yes");										return false;		});						$("#import_porder_form").click(function() {			//alert("asdfasd");			$("#import_form_porder").ajaxSubmit({				type : 'post',				dataType : 'text',				timeout : 1200000,				url : admin_porder_import_form,				success : function(data) {						$("#tmpmsgdiv2").html(data);					var str = $("#tmpmsgdiv2 pre").html();					var obj = $.parseJSON(str);					var code = obj.code;					if (code == "200") {						alert("操作完成:"+obj.message);						loadNav52Data();						// $("#nav55").click();					} else {						alert("操作失败，" + obj.message);					}					return false;				},				error : function(XmlHttpRequest, textStatus, errorThrown) {					alert("操作失败");					return false;				}			});			return false;		});					});	//porder 表示搜索运单号或海关单号	//content 表示搜索的内容	//state 表示搜索的状态，0表示没有打印，1表示已打印	function loadporderlist(porder,content,state,pn,printflag)	{		$(":hidden[name='porder']").val(porder);		$(":hidden[name='content']").val(content);		$(":hidden[name='state']").val(state);		$(":hidden[name='pn']").val(pn);		var seaprintid=$(":hidden[name='seaprintid']").val();				content = encodeURI(content);		$.ajax({			type : "get",			url : "../admin/seaprint/porder",			data : {				seaprintid:seaprintid,				porder : porder,				content : content,				state : state,				pageIndex : pn			},			success : function(response) {				var code = response.code;								if ("200" == code) {					if (response.data == null) {						showPorderList(null,printflag);						showPorderLink(null);					} else {						showPorderList(response.data.datas,printflag);						showPorderLink(response.data);					}				//	afterLoadOrderList();				} else if ("607" == code) {					alert("您尚未登录或登录已失效！");					logout();				} else {					var info = "<td style='text-align: left;' colspan='8'>"							+ "<span>&nbsp;&nbsp;获取运单列表信息失败!</span></td>";					$("#tab1 table tbody").html(info);				}				return false;			}		});	}		function removenull(str)	{		if((str=="")||(str==null)||(str=="null")||(str=="undefined"))		{			return "";		}		else		{			return str;		}	}		//kai 20151004 添加用户提交时的并没有打印的处理方式	function showPorderList(list,printflag) {		var str = "";		if (list != null) {			$.each(list, function() {				str += "<tr id='" + this.id + "'>";											str += "<td><input type='checkbox' name='del_id' value='"							+ this.id + "'/></td>";												str += '<td id="orderId">'+ this.orderId + '</td>';											str += "<td id='divideOrderId'>" + this.divideOrderId + "</td>";				str += "<td>" + this.taxCommuditylists + "</td>";				str += "<td>" + this.sendcompany + "</td>";							str += "<td>" + this.revcompany + "</td>";												str += "<td>" + removenull(this.cprovince)+removenull(this.ccity)+removenull(this.cdist)+removenull(this.caddress)+ "</td>";								str += "<td>" + this.cphone + "</td>";				str += "<td id='cardId'>" + this.cardId + "</td>";				str += "<td>" + this.createDate + "</td>";								if(this.printflag=="1")				{					str += "<td style='color:blue;'>" + "已打印" + "</td>";				}				else				{					str += "<td>" + "未打印" + "</td>";				}											str += "<td><a href='" + this.id				+ "' name='a_porder_print_link'>打印</a> | <a href='" + this.id				+ "' name='a_porder_del_link'>删除</a></td>";								str += "</tr>";								if((printflag=="yes")&&(this.printflag!="1"))				{					//alert(this.id);					if(removenull(this.cardId)!="")					{						var url = admin_print_sea_page_url + "?poid=" + this.id+"&seaorderid="+this.divideOrderId+"&orderid="+this.orderId;						printflag="no";						$("#my_print_div").load(url);					}																		}							});						if(printflag=="yes")			{				printflag="no";				alert("没有符合要求的运单!");			}					} else {			if (str == null || str == '') {				str = "<td style='text-align: left;' colspan='11'>"						+ "<span>&nbsp;&nbsp;没有符合您查找要求的运单信息!</span></td>";			}		}		$("#tab1 table tbody").html(str);				$("a[name='a_porder_print_link']").click(function() {			var oid = $(this).attr("href");						var orderid=$(this).parent().parent().find("td[id='orderId']").html();			var divideOrderId=$(this).parent().parent().find("td[id='divideOrderId']").html();			var cardId=$(this).parent().parent().find("td[id='cardId']").html();			//alert(cardId);			if(removenull(cardId)!="")			{							var url = admin_print_sea_page_url + "?poid=" + oid+"&seaorderid="+divideOrderId+"&orderid="+orderid;				//$("#main-content").load(url);				$("#my_print_div").load(url);			}			else			{				alert("身份证号为空，不能打印!");			}									//$("#main-content").load(url);			return false;		});				$("a[name='a_porder_del_link']").click(function() {			var oid = $(this).attr("href");						$			.ajax({				type : "get",				url : "../admin/seaprint/delete_porder_byid",				data : {					"id" : oid				},				success : function(						response) {					var code = response.code;					//alert(code);					if ("200" == code) {						alert("删除成功");						//nav_seaprint_Click();						var seaprintid=$(":hidden[name='seaprintid']").val();						$("#main-content").load(admin_seaprint_one_page_url+"?id="+seaprintid);					}					else					{						alert("删除失败:"+response.message);					}				}});														//$("#main-content").load(url);			return false;		});	}	function showPorderLink(pageSplit) {		if (pageSplit != null) {			var rowCount = pageSplit.rowCount;			var pageSize = pageSplit.pageSize;			var pageNow = pageSplit.pageNow;			var pageCount = pageSplit.pageCount;			$("tfoot .bulk-actions").show();			$("tfoot .pagination")					.html(							createPaginationHtmlStr(rowCount, pageSize, pageNow,									pageCount));			$("tfoot .pagination a").click(function() {				var pn = $(this).attr("href");												var porder=$(":hidden[name='porder']").val();				var content=$(":hidden[name='content']").val();				var state=$(":hidden[name='state']").val();								loadporderlist(porder,content,state,pn,"");																			return false;			});			$("tfoot .pagination input").keydown(function(event) {				if (event.which == 13) {					var pn = $(this).val();					if (/^\d*$/.test(pn)) {																								var porder=$(":hidden[name='porder']").val();						var content=$(":hidden[name='content']").val();						var state=$(":hidden[name='state']").val();												loadporderlist(porder,content,state,pn,"");																							} else {						alert("只能输入数字");					}					$(this).blur();				}			});		} else {			$("tfoot .bulk-actions").hide();			$("tfoot .pagination").html("");		}	}				function printkeydown(event)	{		event=(event)?event:((window.event)?window.event : "");		var key=event.keyCode? event.keyCode : event.wihch;		//alert(key);			if (key == 13)// 回车事件			{				var porder = $(":text[name='scan_order_no']").val();																$(":text[name='scan_order_no']").val("");																				loadporderlist(porder,"","","1","yes");								return false;			}	}</script></html>