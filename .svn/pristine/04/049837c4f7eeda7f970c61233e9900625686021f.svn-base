<!doctype html>
<html><!-- InstanceBegin template="/Templates/Template.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta charset="utf-8">
<!-- InstanceBeginEditable name="doctitle" -->
<title>91闪淘</title>
<!-- InstanceEndEditable -->
<link rel="stylesheet" type="text/css" href="css/libs/CSSRESET.css">
<link rel="stylesheet" type="text/css" href="css/common.css">
<script src="js/libs/jquery-1.11.1.min.js"></script>
<!-- InstanceBeginEditable name="head" -->
<link rel="stylesheet" type="text/css" href="css/index.css">
<script src="js/libs/jquery.flexslider-min.js"></script>
<script src="js/index.js"></script>
<!-- InstanceEndEditable -->
</head>
<body>
	<section class="menu">
       	<div class="_container">
        	<p>91闪淘为您服务</p>
            <p><a href="../r/login.jsp">登陆</a><a href="../r/register.html">注册</a></p>
        </div>
    </section>
    
	<header class="header">
    	<div class="_container">
        	<h1><a href="javascript:;">91闪购</a></h1>
            
            <div class="search">
				<input type="text" id="spiderOrderUrl" placeholder="请输入宝贝关键词或商品链接" onkeyup="javascript: if(event.keyCode==13){searchSpiderOrder();};"><input type="submit" value="搜索" onclick="searchSpiderOrder();"/>
			</div>
        </div>
    </header>
    <!-- header End -->
    
    <nav class="nav">
    	<div class="_container">
    		<ul class="ul_nav">
				<li><a href="../91gou/index.html">首页</a></li>
				<li><a href="../91gou/discount.html">优惠</a></li>
				<li><a href="javascript:;">晒单</a></li>
				<li><a href="../91gou/gou.html">一键购</a></li>
				<li><a href="javascript:;">联系我们</a></li>
			</ul>  
            <div class="cart">
            	<a href="javascript:;"><span></span>购物车中<em id="cartCount">0</em>件</a>
            </div>
        </div>
    </nav>
    <!-- nav -->
    
    <section class="main">
    	<div class="_container">
        	<h4>购物车>></h4><a href="#" onclick="javascript: clearAllCart();">清空购物车</a>
            <ul class="ul_product" id="productUl">
            	<li>
                	<h5>凑单好货 YUZE伊尤赛 马油 透明洁面皂 100g 日淘 7.6折 <span>JPY 493(￥27.37)</span></h5>
                   
                    <img src="img/index_prod_1.png" />
                    <div class="detail">
                    	<div class="intro">
                            <p>
                                这款YUZE伊尤赛马油透明洁面皂的价格是JPY493（27元，不含运费），需在日亚购满2500日元才可购买，凑单带回即可。日淘购买链接一键直达。<br/>
                                YUZE伊尤赛马油透明洁面皂是由日本知名的护肤品品牌——伊尤赛推出的洁面护肤品，是纯手工制造文字文字文字文文...
                            </p>
                        </div>
                        
                        <p class="clear"><a href="javascript:;">阅读全文</a></p>
                        
                        <div class="func clear">
                        	<div class="func_left">
                            	<a href="javascript:;">0</a>
                                <a href="javascript:;">0</a>
                                <a href="javascript:;">0</a>
                            </div>
                            
                            <div class="func_right">
                            	<a href="javascript:;">购物直达></a>
                                <a href="javascript:;">一键购</a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            
           <div class="paging" id="pagination"><a class="active">1</a><a>2</a><a>3</a><a>...</a><a>下一页</a></div>
           
        </div>
    </section>
    
    <!-- InstanceEndEditable -->
    
    <footer class="footer">
    	<div class="_container">
        	<div class="link">
            	<p>
                	<a href="javascript:;">首页</a>&nbsp;|&nbsp;
                    <a href="javascript:;">最新优惠</a>&nbsp;|&nbsp;
                    <a href="javascript:;">闪淘晒单</a>&nbsp;|&nbsp;
                    <a href="javascript:;">海淘经验</a>
                </p>
                
                <p>
                	<a href="javascript:;">关于我们</a>&nbsp;|&nbsp;
                    <a href="javascript:;">联系我们</a>&nbsp;|&nbsp;
                    <a href="javascript:;">加入我们</a>&nbsp;|&nbsp;
                    <a href="javascript:;">建议反馈</a>
                </p>
            </div>
        
        	<div class="flink">
            	<a href="javascript:;">360导航</a>&nbsp;|&nbsp;
                <a href="javascript:;">中环转运</a>&nbsp;|&nbsp;
                <a href="javascript:;">乐一番</a>&nbsp;|&nbsp;
                <a href="javascript:;">飞碟快递</a>&nbsp;|&nbsp;
                <a href="javascript:;">易海淘</a>&nbsp;|&nbsp;
                <a href="javascript:;">转运中国</a>&nbsp;|&nbsp;
                <a href="javascript:;">先锋快递</a>&nbsp;|&nbsp;
                <a href="javascript:;">瓦拉淘</a>&nbsp;|&nbsp;
                <a href="javascript:;">海带宝</a>&nbsp;|&nbsp;
                <a href="javascript:;">八达网</a>&nbsp;|&nbsp;
                <a href="javascript:;">今日头条</a><br/>
                <a href="javascript:;">网易新闻</a>&nbsp;|&nbsp;
                <a href="javascript:;">搜狐新闻</a>&nbsp;|&nbsp;
                <a href="javascript:;">转运四方</a>
          </div>
             
          <p class="copyright">© copyright 2012-2014 极客海淘. All rights reserved. 京ICP备14036389号-1 京公网安备11010602100083</p>
      </div>
</footer>
</body>
<script src="../resources/scripts/htmlTagUtil.js"></script>
<script src="../resources/scripts/imgUtil.js"></script>
<script src="../resources/scripts/textUtil.js"></script>
<script>
setFooter(".footer");
changePage(1);
getCartCount();
function searchSpiderOrder(){
	sessionStorage.setItem("spiderOrderUrlKeep", $("#spiderOrderUrl").val());
	sessionStorage.removeItem("productIdKeep");
	location.href="../91gou/product_detail.html";
}
function loadList(formData){
	$.ajax({
		type: "post",
		url: "../product/findByUserCart",
		data : formData,
		processData : false,
		contentType : false,
		success: function(response) {
			if(200==response.code ){
				showList(response.data.datas);
				showPage(response.data);
				clearWrongImgNoBaseUrl();
			}else if(36011 == response.code){
				showList(0);
				$("#pagination").html("");
			}
		}
	});
}
function showList(list){
	$("#productUl").html("");
	string = "";
	for(var i=0; i<list.length; i++){
		var product = list[i].product;
		
		string += "<li>";
		var price = product.price;
		if(price == "" || price == -999999){
			price = "待定";
		}
		string += "<h5>" + product.name + "<span>" + product.currency + price + "</h5>";
		string += "<img src='../" + product.pic1 + "'>";
		string += "<div class='detail'>";
		string += "<div class='intro'>";
		string += "<p><div style='font-size: 16px;'>" + removenull(product.description) + "</div></p>";
		string += "</div>";
		var cartId = removenull(list[i].id)=="" ? i : list[i].id;
		string += "<p class='clear'><a href='#' onclick='javascript: deleteCart(" + cartId + ");'>删除</a><a href='../91gou/product_detail.html' onclick='javascript: getProductInfo(" + product.id + ");'>阅读全文</a></p>";
		
		string += "<div class='func clear'>";
		string += "<div class='func_left'>";
		string += "<a href=''>0</a><a href=''>0</a><a href=''>" + product.commentNum + "</a>";
		string += "</div>";
		string += "<div class='func_right'>";
		var website = "<a target='_blank' href='"  + product.url + "'>购物直达></a>";
		if(product.url == "null" || product.url == null || product.url == ""){
			website = "<a style='display: none;'></a>";
		}
		string += website + "<a href='../r/login.jsp' onclick='javascript: checkout(" + product.id + ");'>付款</a>";
		string += "</div>";
		string += "</div>";
		
		string += "</div>";
		string += "</li>";
	}
	$("#productUl").html(string);
}
function showPage(pageSplit){
	$("#pagination").html("");
	var string = "";
	if(pageSplit.pageNow-1 > 0){
		var pageNow = pageSplit.pageNow-1;
		string += "<a onclick='javascript: changePage(" + pageNow + ");'>上一页</a>";
	}
	var active = " class='active' ";
	for(var i=-2; i<3; i++){
		var pageNow = pageSplit.pageNow+i;
		if(pageNow > 0 && (pageNow < pageSplit.pageCount || pageNow == pageSplit.pageCount)){
			string += "<a " + (i==0 ? active : "") + (i==0 ? "" : " onclick='javascript: changePage(" + pageNow + ");' ") + ">" + pageNow + "</a>";
		}
	}
	if(pageSplit.pageNow+1 == pageSplit.pageCount || pageSplit.pageNow+1 < pageSplit.pageCount){
		var pageNow = pageSplit.pageNow+1;
		string += "<a onclick='javascript: changePage(" + pageNow + ");'>下一页</a>";
	}
	$("#pagination").html(string);
}
function changePage(pageIndex){
	var formData = new FormData();
	formData.append("pageIndex", pageIndex);
	var cartArray = localStorage.getItem("cartArray");
	var ids = [];
	if(cartArray != null){
		cartArray = JSON.parse(cartArray);
		for(var i=0; i<cartArray.length; i++){
			ids.push(cartArray[i].productId);
		}
	}
	formData.append("ids", ids);
	loadList(formData);
	return false;
}
function getCartCount(){
	$.ajax({
		type: "get",
		url: "../cart/countCart",
		success: function(response) {
			if(200==response.code || 36019==response.code){
				$("#cartCount").html(response.data);
			}else if(607 == response.code){
				var cartArray = localStorage.getItem("cartArray");
				if(cartArray != null){
					cartArray = JSON.parse(cartArray);
					$("#cartCount").html(cartArray.length);
				}
			}
		}
	});
}
function checkout(){
	sessionStorage.setItem("forwardProductCheckoutPage", true);
}
function clearAllCart(){
	$.ajax({
		type: "post",
		url: "../cart/deleteAll",
		success: function(response) {
			if(200==response.code){
				alert("清空成功");
			}else if(607 == response.code){
				localStorage.removeItem("cartArray");
				changePage(1);
				getCartCount();
			}
		}
	});
}
function deleteCart(id){
	$.ajax({
		type: "post",
		url: "../cart/delete",
		data : {id : id},
		success: function(response) {
			if(200==response.code){
				alert("删除成功");
			}else if(607 == response.code){
				var cartArray = localStorage.getItem("cartArray");
				if(cartArray != null){
					cartArray = JSON.parse(cartArray);
					cartArray.splice(id, 1);
					var newArray = [];
					for(var i=0; i<cartArray.length; i++){
						var cart = {productId : cartArray[i].productId, quantity : cartArray[i].quantity};
						newArray.push(cart);
					}
					localStorage.setItem("cartArray", JSON.stringify(newArray));
					changePage(1);
					getCartCount();
				}
			}
		}
	});
}
function getProductInfo(productId){
	window.sessionStorage.setItem("productIdKeep", productId);
}
</script>
<!-- InstanceEnd --></html>
